<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
	
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<meta http-equiv="description" content="for cloud project"/>
	<meta name="description" content="for cloud project"/>
	<meta name="keywords" content="web ftont, HTML5, ajax, javascript, image upload"/>
	<meta name="author" content="student37"/>
	<link rel="stylesheet" href="./Resource/demo.css" type="text/css"/>
	<link rel="stylesheet" type="text/css" href="./Resource/css/demo.css" />
	<link rel="stylesheet" type="text/css" href="./Resource/css/style.css" />
	<link rel="stylesheet" type="text/css" href="./Resource/css/jquery.jscrollpane.css" media="all" />
	<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow&v1' rel='stylesheet' type='text/css' />
	<link href='http://fonts.googleapis.com/css?family=Coustard:900' rel='stylesheet' type='text/css' />
	<link href='http://fonts.googleapis.com/css?family=Rochester' rel='stylesheet' type='text/css' />
	<!-- fancy box css for browsing images-->
	<link rel="stylesheet" type="text/css" href="./Resource/fancyBox/jquery.fancybox.css" media="screen" />
	
	<title>Face Search</title>


<style type="text/css">
.upload_box{width:800px; margin:1em auto;}
.upload_main{border-width:1px 1px 2px; border-style:solid; border-color:#ccc #ccc #ddd; background-color:#fbfbfb;}
.upload_choose{padding:1em;}
.upload_drag_area{display:inline-block; width:60%; padding:4em 0; margin-left:.5em; border:1px dashed #ddd; background:#fff url(http://rescdn.qqmail.com/zh_CN/htmledition/images/func/dragfile07bf38.gif) no-repeat 20px center; color:#999; text-align:center; vertical-align:middle;}
.upload_drag_hover{border-color:#069; box-shadow:inset 2px 2px 4px rgba(0, 0, 0, .5); color:#333;}
.upload_preview{border-top:1px solid #bbb; border-bottom:1px solid #bbb; background-color:#fff; overflow:hidden; _zoom:1;}
.upload_append_list{height:300px; padding:0 1em; float:left; position:relative;}
.upload_delete{margin-left:2em;}
.upload_image{max-height:250px; padding:5px;}
.upload_submit{padding-top:1em; padding-left:1em;}
.upload_submit_btn{display:none; height:32px; font-size:14px;}
.upload_loading{height:250px; background:url(http://www.zhangxinxu.com/study/image/loading.gif) no-repeat center;}
.upload_progress{display:none; padding:5px; border-radius:10px; color:#fff; background-color:rgba(0,0,0,.6); position:absolute; left:25px; top:45px;}
</style>

<style id="clearly_highlighting_css" type="text/css">
/* selection */ html.clearly_highlighting_enabled ::-moz-selection { background: rgba(246, 238, 150, 0.99); } html.clearly_highlighting_enabled ::selection { background: rgba(246, 238, 150, 0.99); } /* cursor */ html.clearly_highlighting_enabled {    /* cursor and hot-spot position -- requires a default cursor, after the URL one */    cursor: url("chrome-extension://pioclpoplcdbaefihamjohnefbikjilc/clearly/images/highlight--cursor.png") 14 16, text; } /* highlight tag */ em.clearly_highlight_element {    font-style: inherit !important; font-weight: inherit !important;    background-image: url("chrome-extension://pioclpoplcdbaefihamjohnefbikjilc/clearly/images/highlight--yellow.png");    background-repeat: repeat-x; background-position: top left; background-size: 100% 100%; } /* the delete-buttons are positioned relative to this */ em.clearly_highlight_element.clearly_highlight_first { position: relative; } /* delete buttons */ em.clearly_highlight_element a.clearly_highlight_delete_element {    display: none; cursor: pointer;    padding: 0; margin: 0; line-height: 0;    position: absolute; width: 34px; height: 34px; left: -17px; top: -17px;    background-image: url("chrome-extension://pioclpoplcdbaefihamjohnefbikjilc/clearly/images/highlight--delete-sprite.png"); background-repeat: no-repeat; background-position: 0px 0px; } em.clearly_highlight_element a.clearly_highlight_delete_element:hover { background-position: -34px 0px; } /* retina */ @media (min--moz-device-pixel-ratio: 2), (-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2) {    em.clearly_highlight_element { background-image: url("chrome-extension://pioclpoplcdbaefihamjohnefbikjilc/clearly/images/highlight--yellow@2x.png"); }    em.clearly_highlight_element a.clearly_highlight_delete_element { background-image: url("chrome-extension://pioclpoplcdbaefihamjohnefbikjilc/clearly/images/highlight--delete-sprite@2x.png"); background-size: 68px 34px; } } </style><style>[touch-action="none"]{ -ms-touch-action: none; touch-action: none; }[touch-action="pan-x"]{ -ms-touch-action: pan-x; touch-action: pan-x; }[touch-action="pan-y"]{ -ms-touch-action: pan-y; touch-action: pan-y; }[touch-action="scroll"],[touch-action="pan-x pan-y"],[touch-action="pan-y pan-x"]{ -ms-touch-action: pan-x pan-y; touch-action: pan-x pan-y; }
</style>
<!-- fancy box style -->
<style type="text/css">
		.fancybox-custom .fancybox-skin {
			box-shadow: 0 0 50px #222;
		}
</style>
</head>

<body>
<div id="header">
    <h3>Face &nbsp;&nbsp; Search</h3>
</div>
<div id="main">
	<h1>Face Search Engine</h1>
    <div id="body" class="light">
    	<div id="content" class="show">
        	<h3>Project Demo</h3>
            <div class="article_new"><a href="index.html">Text Search!</a></div>
            <div class="demo">
            	<form id="uploadForm" target="frm_dealer" action="uploadimage" method="post" enctype="multipart/form-data">
                    <div class="upload_box">
                        <div class="upload_main">
                            <div class="upload_choose">
                                <input id="fileImage" type="file" size="30" name="fileselect[]" multiple=""/>
                                <!--  <span id="fileDragArea" class="upload_drag_area">Drag your image here</span>-->
                            </div>
                            <div id="preview" class="upload_preview"></div>
                        </div>
                        <div class="upload_submit">
                            <button type="submit" id="fileSubmit" class="upload_submit_btn">Confirm to upload image</button>
                        </div>
                        <div id="uploadInf" class="upload_inf"></div>
                    </div>
			    </form>  
			    
			    <div id="loading">
				    <div id="shapeblue" class="bar"></div>
					<div id="shapepink" class="bar"></div>
			    </div>
			    
			    <!-- use to show the result of the faces -->
			    <iframe name="frm_dealer" id="face_result" style="display:none" onload="onIFrameLoaded(this);"></iframe>
			    <!-- start of images area -->
			    
			    <div id="ca-container" class="ca-container" style="display:none">
					<div id="ca-wrapper" class="ca-wrapper">
					</div>
					<div id="input_image"></div>
				</div>
			    
			    <!-- end of images area -->
            </div>
        </div>       
    </div>
</div>
<div id="footer">
    Designed by Wang Yan, Xu ZuLiang<br/>
    Powered by <a href="http://www.cs.hku.hk/">HKUCS Cluster</a><br/>
    Copyright© HKU<br/>    
</div>


<script type="text/javascript" src="./Resource/jquery-2.1.0.min.js"></script>
<script type="text/javascript" src="./Resource/zxxFile.js"></script>
<script type="text/javascript" src="./Resource/js/jquery.easing.1.3.js"></script>
<!-- the jScrollPane script -->
<script type="text/javascript" src="./Resource/js/jquery.mousewheel.js"></script>
<script type="text/javascript" src="./Resource/js/jquery.contentcarousel.js"></script>

<!-- Add fancyBox main JS and CSS files -->
<script type="text/javascript" src="./Resource/fancyBox/jquery.fancybox.js"></script>

<script type="text/javascript">
	var playAnimate;
	$(function() {
	    var wwidth = $(window).width();
	    var bluewidth = $("#shapeblue").width();
	    $("#shapeblue").css("left", (wwidth/2) - bluewidth);
	
	    var bluepos = $("#shapeblue").position();
	    var movex = $("#shapeblue").width() + 4;
	    $("#shapepink").css("left", bluepos.left + movex);
	    $("#loading").hide();
	    
	    function moveleft(el) {
	        $(el).animate({
	            left: '+='+movex
	        }, 800, function() {
	            $(el).css("z-index", "5");
	        });
	    }
	
	    function moveright(el) {
	        $(el).animate({
	            left: '-='+movex
	        }, 800, function() {
	            $(el).css("z-index", "10");
	        });
	    }
	
	    function playAnimation() {
	        moveleft("#shapeblue");
	        moveright("#shapeblue");
	        moveright("#shapepink");
	        moveleft("#shapepink");
	    }
	
	    $("#fileSubmit").click(function() {
	    	$("#loading").show();
	    	playAnimate = setInterval(playAnimation, 800);
	    	
	    	// send request
	    	 $("#uploadForm").submit();
	    	
	        return false;
	    });
	});
	
	$(document).ready(function(){
		$('#ca-container').contentcarousel();
	});
	
	function onIFrameLoaded(iframe) {
		setTimeout(function(){
			var doc = iframe.contentWindow.document;
		    var html = doc.body.innerHTML;
		    
		    // hide the animation
		    $("#loading").hide();
		    clearInterval(playAnimate);
		    
		    // json parser, convert to js array
		    photos = $.parseJSON(html);
		    var isHandsome = false;
		    var HandsomeNum = 0;
		    // show the result images
		    for (var i = 0; i < photos.length; i++) {
		    	// image name, image path, image description
		    	if (photos[i].name == null) {
		    		addImageItem(photos[i].path, photos[i].path, photos[i].descirption);
		    	} else {
		    		addImageItem(photos[i].name, photos[i].path, photos[i].descirption);
		    	}
		    	
		    	if (photos[i].handsome == true) HandsomeNum += 1;
		    }
		    
		    if (HandsomeNum > photos.length/2.0) isHandsome = true;
		    
		    if (isHandsome) showCrown();
		    
		    $("#ca-container").fadeIn();
		    
		    //Simple image gallery
		    $('.fancybox').fancybox();
		},2000);
	}
	
	function addImageItem(imageName, imagePath, imageDes) {
		var imageHtml = "<div class=\"ca-item\"><div class=\"ca-item-main\"><div class=\"ca-icon\">"
		+ "<a class=\"fancybox\" href=\"ximages/" + imagePath + "\" data-fancybox-group=\"gallery\" title=\"" + imageDes + "\"><img src=\"fimages/" + imagePath + "\" /></a>"
		+ "</div><h3>"+ imageName +"</h3><h4><span class=\"ca-quote\">&ldquo;</span><span>" + imageDes + "</span></h4></div></div>";
		$("#ca-wrapper").append(imageHtml);
	}
	
	function showCrown() {
		$("#input_image").append('<img src="Resource/stamp.png" class="handsome">');
	}

	var params = {
		fileInput: $("#fileImage").get(0),
		dragDrop: $("#fileDragArea").get(0),
		upButton: $("#fileSubmit").get(0),
		url: $("#uploadForm").attr("action"),
		filter: function(files) {
			var arrFiles = [];
			for (var i = 0, file; file = files[i]; i++) {
				if (file.type.indexOf("image") == 0) {
					if (file.size >= 102400000) {
						alert('This "'+ file.name +'" should not larger than 1MB');
						$("#fileImage").val("");
					} else {
						arrFiles.push(file);	
					}			
				} else {
					alert('This file "' + file.name + '" is not image.');	
				}
			}
			return arrFiles;
		},
		onSelect: function(files) {
			var html = '', i = 0;
			
			// hide and clean the result area
			$("#ca-container").hide();
			$("#ca-wrapper").html(html);
			$("#preview").html('<div class="upload_loading"></div>');
			
			var funAppendImage = function() {
				file = files[i];
				if (file) {
					var reader = new FileReader()
					reader.onload = function(e) {
						$('#fileImage').hide();
						html = html + '<div id="uploadList_'+ i +'" class="upload_append_list"><p><strong>' + file.name + '</strong>'+ 
							'<a href="javascript:" class="upload_delete" title="delete" data-index="'+ i +'">Delete</a><br />' +
							'<img id="uploadImage_' + i + '" src="' + e.target.result + '" class="upload_image" /></p>'+ 
							'<span id="uploadProgress_' + i + '" class="upload_progress"></span>' +
						'</div>';
						
						$("#input_image").html('<img src="' + e.target.result + '" />');
						
						i++;
						funAppendImage();
					}
					reader.readAsDataURL(file);
				} else {
					$("#preview").html(html);
					if (html) {
						//delete method
						$(".upload_delete").click(function() {
							ZXXFILE.funDeleteFile(files[parseInt($(this).attr("data-index"))]);
							return false;	
						});
						//submit button show
						$("#fileSubmit").show();	
					} else {
						//submit button hide
						$("#fileSubmit").hide();	
					}
				}
			};
			funAppendImage();		
		},
		onDelete: function(file) {
			//$("#uploadList_" + file.index).fadeOut();
			$("#uploadList_" + file.index).hide();
			$("#fileSubmit").hide();
			$('#fileImage').show();
			$("#fileImage").val("");
		},
		onDragOver: function() {
			$(this).addClass("upload_drag_hover");
		},
		onDragLeave: function() {
			$(this).removeClass("upload_drag_hover");
		},
		onProgress: function(file, loaded, total) {
			var eleProgress = $("#uploadProgress_" + file.index), percent = (loaded / total * 100).toFixed(2) + '%';
			eleProgress.show().html(percent);
		},
		onSuccess: function(file, response) {
			//$("#uploadInf").append("<p>Upload successfully，Image Address：" + response + "</p>");
		},
		onFailure: function(file) {
			$("#uploadInf").append("<p>Image " + file.name + " fail to be uploaded</p>");	
			$("#uploadImage_" + file.index).css("opacity", 0.2);
		},
		onComplete: function() {
			//submit button hide
			$("#fileSubmit").hide();
			//set empty to file value
			$("#fileImage").val("");
		}
	};
	ZXXFILE = $.extend(ZXXFILE, params);
	ZXXFILE.init();
</script>

</body>
</html>